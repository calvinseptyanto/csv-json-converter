<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>CSV to JSON Converter</title>
    <script src="elm.js"></script>
    <!-- Will be created by compiling Elm -->
  </head>
  <body>
    <input type="file" id="fileInput" />
    <div id="elm"></div>
    <script>
      var app = Elm.Main.init({
        node: document.getElementById("elm"),
      });

      // Get the file input element
      var fileInput = document.getElementById("fileInput");

      fileInput.addEventListener("change", function () {
        var file = fileInput.files[0];
        var reader = new FileReader();

        reader.onload = function (e) {
          var csvContent = e.target.result;
          var rows = csvContent.split(/\r\n|\n/);
          var jsonArray = rows.map(function (row) {
            var columns = row.split(",");
            var obj = {};
            columns.forEach(function (column, index) {
              obj["field" + index] = column;
            });
            return obj;
          });

          // Send the JSON data to Elm
          app.ports.convertComplete.send(jsonArray);
        };

        reader.readAsText(file);
      });

      app.ports.convertComplete.subscribe(function (json) {
        // Handle JSON data here (e.g., display it or allow the user to save it)
        console.log("Received JSON from Elm: ", json);
      });
    </script>
  </body>
</html>
